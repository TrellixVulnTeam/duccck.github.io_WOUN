<!doctype html>
<html>

<head>
  <title>FTC</title>
  <style>
    #container {
      width: 100px;
      height: 105px;
      border: 1px solid black;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="container"></div>
  <button id="action">Next</button>

  <script>
    function query(id) {
      return document.getElementById(id);
    }

    let div = query("container");
    let button = query("action");

    let count = 25;
    while (count) {
      let input = document.createElement("input");
      input.type = "checkbox";
      input.checked = false;
      input.className = "checkbox"
      div.append(input);
      count--;
    }

    let checkArr = Array.from(document.getElementsByClassName("checkbox"));
    button.addEventListener("click", () => {
      // debugger;

      let arrCopy = [];
      checkArr.forEach(el => arrCopy.push(el.checked));
      arrCopy.forEach((el, index) => {
        let stateArr = [];
        let indexArr = [];
        if ((index + 1) % 5 == (index + 1)) {
          if (index == 0) {
            indexArr.push(1, 5, 6);
          } else {
            indexArr.push(index - 1, index + 1, index + 4, index + 5, index + 6);
          }
        } else if ((index + 1) % 5 == 1) {
          if (index % 5 == 0) {
            indexArr.push(index - 5, index - 6, index + 1);
          } else {
            indexArr.push(index - 5, index - 4, index + 5, index + 6);
          }
        } else if ((index + 1) % 5 == 0) {
          if ((index + 1) == arrCopy.length) {
            indexArr.push(index - 6, index - 5, index - 1);
          } else if ((index + 1) == 5) {
            indexArr.push(index - 1, index + 4, index = 5);
          } else {
            indexArr.push(index - 6, index - 5, index - 1, index + 4, index + 5);
          }
        } else if (index > arrCopy.length - 5 && index < arrCopy.length - 1) {
          indexArr.push(index - 6, index - 5, index - 4, index - 1, index + 1);
        } else {
          indexArr.push(index - 1, index - 4, index - 5, index - 6, index + 1, index + 4, index + 5, index + 6);
        }
        indexArr.forEach(el => {
          if (arrCopy[el]) {
            stateArr.push(1);
          } else {
            stateArr.push(0);
          }
        });
        let count = 0;
        stateArr.forEach(el => {
          if (el == 1) {
            count++;
          }
        });
        if (el) {
          if (count < 2 || count > 3) {
            checkArr[index].checked = false;
          }
        } else {
          if (count == 3) {
            checkArr[index].checked = true;
          }
        }
      });
    });
  </script>
</body>

</html>